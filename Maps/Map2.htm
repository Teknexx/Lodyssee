<!-- Code par TekneX -->
<!-- https://github.com/Teknexx -->

<!DOCTYPE html>
<html>
<head>
	<title>Map 2</title>
	<meta charset="utf-8">
	<link rel="icon" type="png" href="Images/iconehero.png"/>
	<link rel="stylesheet" type="text/css" href="script.css">
</head>
<body>
	<canvas id="canvas" width="500" height="500">Votre naviguateur ne navigue pas sur du canvas</canvas>

<script type="text/javascript">



	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');
	var sldt = new Image();
    var hero_droite = new Image();
	var hero_gauche = new Image();
	hero_droite.src = "Images/hero_droite.png";
    hero_gauche.src = "Images/hero_gauche.png";
    sldt.src = 'Images/soldat.png';

    var senshero = "droite";

	var largeur = 500;
	var hauteur = 500;

	var rayon = 20
    var centrex = rayon + 0;
    var centrey = rayon + 440;

    var rayonennemi = 20;
    var centrexennemi = 425;
    var centreyennemi = 440;

	var pxldepl = 10;


	var testColision = false;
    var tabObstacles = [    //[type,coordonnée x, coordonnée y, rayon]
    ["rectangle",0, 200, 46, 200],
    ["rectangle",104, 200, 291, 200],
    ["rectangle",453, 200, 47, 200],
    ["rectangle",150, 400, 200, 100],
    ["rectangle",490, 0, 10, 500],
    //bordures
    ["rectangle",0, 0, 10, 200], //gauche
    ["rectangle",10, 0, 480, 10], //haut
    ["rectangle",490, 0, 10, 500], //droite
    ["rectangle",0, 490, 150, 10] //bas
    ]; 


	document.addEventListener('keydown', function(event) {


		//touches deplacement
		var touche = event.key;

		if (touche == "ArrowUp") {
			centrey = centrey - pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey + pxldepl;
			}
		}
		if (touche == "ArrowLeft") {
			senshero = "gauche";
			centrex = centrex - pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex + pxldepl;
			}
		}
		if (touche == "ArrowDown") {
			centrey = centrey + pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey - pxldepl;
			}
		}
		if (touche == "ArrowRight") {
			senshero = "droite";
			centrex = centrex + pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex - pxldepl;
			}
		}

		//map précédente
	    if (0>(centrex-rayon)) {
	    	document.location.href="Map1_retour.htm";
	    }
	    
	    //colision ennemi
	    if (rayon+rayonennemi >= Math.sqrt(Math.pow(centrexennemi-centrex,2)+Math.pow(centreyennemi-centrey,2))){
	    	document.location.href="Ennemi.htm";
		}

		//blocage bordures
	    if (centrex>=(largeur-rayon)) {
	    	centrex = (largeur-rayon);
	    }
	    if (centrex<=rayon) {
	    	centrex = rayon;
	    }
	    if (centrey>=(largeur-rayon)) {
	    	centrey = (largeur-rayon);
	    }
	    if (centrey<=rayon) {
	    	centrey = rayon;
	    }
	    
	    

	});


    //Colisions 
    function Colision() {

		testColision = false;
		for (var i = 0; i < tabObstacles.length; i++) {
			if (tabObstacles[i][0]=="cercle") {
				testColision = testColision || testColisionCirc(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3]);
			}
			if (tabObstacles[i][0]=="rectangle") {
				testColision = testColision || testColisionRect(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3],tabObstacles[i][4]);
			}
		}
	}

	function testColisionCirc(xp,yp,rp,xc,yc,rc){

		var test = false;
		if (rp+rc >= Math.sqrt(Math.pow(xc-xp,2)+Math.pow(yc-yp,2))){
			test = true;
		} return test;

	}

	function testColisionRect(xp,yp,rp,xrect,yrect,larg,haut){

		var test = false;
		var xfin = xrect + larg;
		var yfin = yrect + haut;
		if ( (xp+rp)>xrect && (xp-rp)<xfin && (yp+rp)>yrect && (yp-rp)<yfin ){
			test = true;
		} return test;

	}

	boucle()

	function boucle() {


		context.clearRect(0, 0, largeur, hauteur);


		//LAC
		context.fillStyle= "#0000ff"; //RecLac gauche
		context.fillRect(0, 200, 46, 200);

		context.fillStyle= "#0000ff"; //RecLac milieu
		context.fillRect(104, 200, 291, 200);

		context.fillStyle= "#0000ff"; //RecLac droite
		context.fillRect(453, 200, 47, 200);

		context.fillStyle= "#0000ff"; //RecLac BAS
		context.fillRect(150, 400, 200, 100);

		//CHEMIN
		context.fillStyle= "#3d2b1f"; //Pont gauche
		context.fillRect(46, 190, 58, 220);

		context.fillStyle= "#3d2b1f"; //Pont droite
		context.fillRect(395, 190, 58, 220);

		context.fillStyle= "#f5deb3"; //ch bas gauche
		context.fillRect(0, 440, 53, 45);

		context.beginPath();
		context.arc(53, 440, 45, Math.PI/2, 0, true);
		context.lineTo(53, 440);
		context.fillStyle= "#f5deb3";
		context.fill();
		context.closePath();

		context.fillStyle= "#F5DEB3"; //chemin sur le pont gauche
		context.fillRect(53, 140, 45, 300);

		//chemin apres le pont (en haut quoi)
		context.beginPath();
		context.arc(98, 140, 45, Math.PI, Math.PI*3/2);
		context.lineTo(98, 140);
		context.fillStyle= "#f5deb3";
		context.fill();
		context.closePath();

		context.fillStyle= "#f5deb3"; //chemin en haut
		context.fillRect(98, 95, 304, 45);

		context.beginPath(); //haut droite 
		context.arc(402, 140, 45, Math.PI/2*3, 0, false);
		context.lineTo(402, 140);
		context.fillStyle= "#f5deb3";
		context.fill();
		context.closePath();

		context.fillStyle= "#F5DEB3"; //chemin sur pont droite 
		context.fillRect(402, 140, 45, 360);

		//CONTOURS
		context.fillStyle= "#006400"; //buisson gauche
		context.fillRect(0, 0, 10, 200);

		context.fillStyle= "#006400"; //buisson haut
		context.fillRect(10, 0, 480, 10);

		context.fillStyle= "#0000ff"; //ligne d'eau
		context.fillRect(490, 0, 10, 500);

		context.fillStyle= "#ababab";  //Bâtiment
		context.fillRect(0, 490, 150, 10);

	    if (senshero == "droite") {
	    	context.drawImage(hero_droite, centrex - 20, centrey - 20, 40, 40);
	    }else{
	    	context.drawImage(hero_gauche, centrex - 20, centrey - 20, 40, 40);
	    }

	    context.drawImage(sldt, 380, 420, 70, 70); //boss

		requestAnimationFrame(boucle);
	} 
	</script>
</body>
</html>
