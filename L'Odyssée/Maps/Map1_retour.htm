<!-- Code par TekneX -->
<!-- https://github.com/Teknexx -->

<!DOCTYPE html>
<html>
<head>
	<title>Map1</title>
	<meta charset="utf-8">
	<link rel="icon" type="png" href="Images/iconehero.png"/>
	<link rel="stylesheet" type="text/css" href="script.css">
</head>
<body>
	<canvas id="canvas" width="500" height="500">Votre naviguateur ne navigue pas sur du canvas</canvas>

<script type="text/javascript">

	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');
	var image1 = new Image();
	var image2 = new Image();
	var hero_droite = new Image();
	var hero_gauche = new Image();
    image1.src = "Images/CanardDroite.png";
    image2.src = "Images/CanardGauche.png";
    hero_droite.src = "Images/hero_droite.png";
    hero_gauche.src = "Images/hero_gauche.png";

    var senshero = "gauche";

	var largeur = 500;
	var hauteur = 500;
    var rayon = 20;
    var pxldepl = 10;
    var knarx = 280;
	var sens = 1;

    var centrex = hauteur - rayon;
    var centrey = largeur - rayon - 20;

    var testColision = false;
    var tabObstacles = [    //[type,coordonnée x, coordonnée y, rayon]
    ["cercle",300, 300, 100], //lac
    ["rectangle",300, 200, 200, 200], //relac
    //bordures
    ["rectangle",490, 0, 10, 200], //droite
    ["rectangle",0, 490, 500, 10], //bas
    ["rectangle",0, 0, 500, 10], //haut
    ["rectangle",0, 0, 10, 490] //gauche
    ]; 

	document.addEventListener('keydown', function(event) {


		//touches deplacement
		var touche = event.key;

		if (touche == "ArrowUp") {
			centrey = centrey - pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey + pxldepl;
			}
		}
		if (touche == "ArrowLeft") {
			senshero = "gauche";
			centrex = centrex - pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex + pxldepl;
			}
		}
		if (touche == "ArrowDown") {
			centrey = centrey + pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey - pxldepl;
			}
		}
		if (touche == "ArrowRight") {
			senshero = "droite";
			centrex = centrex + pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex - pxldepl;
			}
		}

		//map suivante
	    if (500<(centrex+rayon)) {
	    	document.location.href="Map2.htm";
	    }

		//blocage bordures
	    if (centrex>=(largeur-rayon)) {
	    	centrex = (largeur-rayon);
	    }
	    if (centrex<=rayon) {
	    	centrex = rayon;
	    }
	    if (centrey>=(largeur-rayon)) {
	    	centrey = (largeur-rayon);
	    }
	    if (centrey<=rayon) {
	    	centrey = rayon;
	    }



	    
	    

	});


    //Colisions 
    function Colision() {

		testColision = false;
		for (var i = 0; i < tabObstacles.length; i++) {
			if (tabObstacles[i][0]=="cercle") {
				testColision = testColision || testColisionCirc(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3]);
			}
			if (tabObstacles[i][0]=="rectangle") {
				testColision = testColision || testColisionRect(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3],tabObstacles[i][4]);
			}
		}
	}

	function testColisionCirc(xp,yp,rp,xc,yc,rc){

		var test = false;
		if (rp+rc >= Math.sqrt(Math.pow(xc-xp,2)+Math.pow(yc-yp,2))){
			test = true;
		} return test;

	}

	function testColisionRect(xp,yp,rp,xrect,yrect,larg,haut){

		var test = false;
		var xfin = xrect + larg;
		var yfin = yrect + haut;
		if ( (xp+rp)>xrect && (xp-rp)<xfin && (yp+rp)>yrect && (yp-rp)<yfin ){
			test = true;
		} return test;

	}

	boucle()

	function boucle() {

		context.clearRect(0, 0, largeur, hauteur);
	        
		
		//lac
	    context.beginPath(); //LE LAC
	    context.arc(300, 300, 100, Math.PI/2, Math.PI*3/2);
	    context.fillStyle = "#0000ff";
	    context.fill();
	    context.closePath();

	    context.fillStyle= "#0000ff"; //RecLac
	    context.fillRect(300, 200, 200, 200);

	    //Déplacement Canard
		if (sens==1) {

		    knarx = knarx + 0.5;
		    context.drawImage(image1, 0, 0, 256, 256, knarx, 280, 40, 40);//Canard gauche
		    if (knarx==400) {
		        sens=0;
		    }
		}else {
		    knarx = knarx - 0.5;
		    context.drawImage(image2, 0, 0, 256, 256, knarx, 280, 40, 40);//Canard droite
		    if (knarx==220) {
		        sens=1;
			}
		}

	    context.fillStyle = "#F5DEB3"; //CHEMIN DU HAUT NO 1
    	context.fillRect(0, 10, 330, 45);

        context.beginPath(); //CH HAUT->LAC GC NO 2.1
        context.arc(330, 90, 80, Math.PI*3/2, Math.PI/2)
        context.fillStyle = "#F5DEB3";
        context.fill();
        context.closePath();

        context.beginPath(); //CH HAUT->LAC PETIT CERCLE NO 2.2
        context.arc(330, 90, 35, Math.PI*3/2, Math.PI/2);
        context.fillStyle = "#3A9D23"
        context.fill();
        context.closePath();

    	context.fillStyle = "#f5deb3"; //CH INTER NO3
    	context.fillRect(185, 125, 145, 45);

        context.beginPath(); //CH ARC NO 4.1
        context.arc(185, 215, 90, Math.PI, Math.PI*3/2,);
        context.lineTo(185, 215)
        context.fillStyle = "#f5deb3";
        context.fill();
        context.closePath();

        context.beginPath(); //CH ARC NO 4.2
        context.arc(185, 215, 45, Math.PI, Math.PI*3/2);
        context.lineTo(185, 215)
        context.fillStyle = "#3a9d23";
        context.fill();
        context.closePath();

    	context.fillStyle = "#f5deb3"; //CH NO 5
    	context.fillRect(95, 215, 45, 180)

        context.beginPath(); //CH ARC NO 6.1
        context.arc(185, 395, 90, Math.PI/2, Math.PI);
        context.lineTo(185, 395)
        context.fillStyle = "#f5deb3";
        context.fill();
        context.closePath();

        context.beginPath(); //CH ARC NO 6.2
        context.arc(185, 395, 45, Math.PI/2, Math.PI);
        context.lineTo(185, 395)
        context.fillStyle = "#3a9d23";
        context.fill();
        context.closePath();

    	context.fillStyle = "#f5deb3" //CH NO 7 DERNIER RECTANGLE
    	context.fillRect(185, 440, 315, 45)

    	//CONTOURS

    	context.fillStyle= "#006400"; //buisson droite
		context.fillRect(490, 0, 10, 200);

		context.fillStyle= "#ababab"; //batiment en bas 
		context.fillRect(0, 490, 500, 10);

		context.fillStyle= "#006400"; //buisson haut
		context.fillRect(0, 0, 500, 10);

		context.fillStyle= "#006400"; //buisson gauche
		context.fillRect(0, 0, 10, 490);

	    if (senshero == "droite") {
	    	context.drawImage(hero_droite, centrex - 20, centrey - 20, 40, 40);
	    }else{
	    	context.drawImage(hero_gauche, centrex - 20, centrey - 20, 40, 40);
	    }

    

		requestAnimationFrame(boucle);
	} 

</script>
</body>
</html>
