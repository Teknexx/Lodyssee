<!-- Code par TekneX -->
<!-- https://github.com/Teknexx -->

<!DOCTYPE html>
<html>
<head>
	<title>Map 3</title>
	<meta charset="utf-8">
	<link rel="icon" type="png" href="Images/iconehero.png"/>
	<link rel="stylesheet" type="text/css" href="script.css">
</head>
<body>
	<canvas id="canvas" width="500" height="500">Votre naviguateur ne navigue pas sur du canvas</canvas>

<script type="text/javascript">


	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');
	var hero_droite = new Image();
	var hero_gauche = new Image();
	hero_droite.src = "Images/hero_droite.png";
    hero_gauche.src = "Images/hero_gauche.png";

    var senshero = "droite";

	var largeur = 500;
	var hauteur = 500;

	var rayon = 20;
	var centrex = rayon;
	var centrey = hauteur / 2;

	var pxldepl = 10;

	var testColision = false;
	var tabObstacles = [    //[type,coordonnée x, coordonnée y, rayon]
		["rectangle",150, 0, 200, 80], //eau haut
		["rectangle",150, 420, 200, 80], //eau bas
		//bordures
		["rectangle",490, 0, 10, 500], //droite
		["rectangle",350, 490, 140, 10], //bas
		["rectangle",0, 0, 150, 50], //mur haut
		["rectangle",0, 450, 150, 50], //mur bas
		["rectangle",0, 0, 50, 225], //mur gauche haut
		["rectangle",0, 275, 50, 225] //mur gauche bas
	]; 

	document.addEventListener('keydown', function(event) {


		//touches deplacement
		var touche = event.key;

		if (touche == "ArrowUp") {
			centrey = centrey - pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey + pxldepl;
			}
		}
		if (touche == "ArrowLeft") {
			senshero = "gauche";
			centrex = centrex - pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex + pxldepl;
			}
		}
		if (touche == "ArrowDown") {
			centrey = centrey + pxldepl;
			Colision()
			if (testColision==true) {
			centrey = centrey - pxldepl;
			}
		}
		if (touche == "ArrowRight") {
			senshero = "droite";
			centrex = centrex + pxldepl;
			Colision()
			if (testColision==true) {
			centrex = centrex - pxldepl;
			}
		}

		//map précédente
		if (0>(centrey-rayon)) {
			document.location.href="Map2_retour.htm";
		}
		//map suivante
		if (0>(centrex-rayon)) {
			document.location.href="Map4_Boss.htm";
		}

		//blocage bordures
		if (centrex>=(largeur-rayon)) {
			centrex = (largeur-rayon);
		}
		if (centrex<=rayon) {
			centrex = rayon;
		}
		if (centrey>=(largeur-rayon)) {
			centrey = (largeur-rayon);
		}
		if (centrey<=rayon) {
			centrey = rayon;
		}



	});


	//Colisions 
    function Colision() {

		testColision = false;
		for (var i = 0; i < tabObstacles.length; i++) {
			if (tabObstacles[i][0]=="cercle") {
				testColision = testColision || testColisionCirc(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3]);
			}
			if (tabObstacles[i][0]=="rectangle") {
				testColision = testColision || testColisionRect(centrex,centrey,rayon,tabObstacles[i][1],tabObstacles[i][2],tabObstacles[i][3],tabObstacles[i][4]);
			}
		}
	}

	function testColisionCirc(xp,yp,rp,xc,yc,rc){

		var test = false;
		if (rp+rc >= Math.sqrt(Math.pow(xc-xp,2)+Math.pow(yc-yp,2))){
			test = true;
		} return test;

	}

	function testColisionRect(xp,yp,rp,xrect,yrect,larg,haut){

		var test = false;
		var xfin = xrect + larg;
		var yfin = yrect + haut;
		if ( (xp+rp)>xrect && (xp-rp)<xfin && (yp+rp)>yrect && (yp-rp)<yfin ){
			test = true;
		} return test;

	}



	boucle()

	function boucle() {


		context.clearRect(0, 0, largeur, hauteur);

		//LAC
		context.fillStyle= "#0000ff"; //lac rectangle HAUT
		context.fillRect(150, 0, 200, 80);

		context.fillStyle= "#0000ff"; //lac rectangle BAS
		context.fillRect(150, 420, 200, 80);


		//CHEMIN
		context.fillStyle= "#f5deb3"; //premier chemin HAUT DROITE 
		context.fillRect(402, 0, 45, 236);

		context.beginPath(); //virage 
		context.arc(402, 236, 45, 0, Math.PI/2, false);
		context.lineTo(402, 236)
		context.fillStyle= "#f5deb3";
		context.fill(); 
		context.closePath(); 

		context.fillStyle= "#f5deb3"; //gros rect apres le boss
		context.fillRect(0, 160, 150, 180); //rgb(119, 90, 73);

		context.fillRect(351, 220, 51, 61) //chemin

		context.beginPath(); //triangle haut
		context.moveTo(150, 160);
		context.lineTo(351, 220); 
		context.lineTo(150, 220);
		context.fill();
		context.closePath();

		context.beginPath(); //triangle bas
		context.moveTo(150, 340);
		context.lineTo(351, 281); 
		context.lineTo(150, 281);
		context.fill();
		context.closePath();

		context.fillRect(150, 220, 351 - 150, 281-220); 

		context.fillStyle= "#ababab"; //mur haut gauche
		context.fillRect(0, 0, 50, 225);

		context.fillStyle= "#ababab"; //mur haut bas
		context.fillRect(0, 275, 50, 225);

		//CONTOURS
		context.fillStyle= "#ababab"; //mur gris HAUT
		context.fillRect(0, 0, 150, 50);

		context.fillStyle= "#ababab"; //mur gris BAS
		context.fillRect(0, 450, 150, 50);

		context.fillStyle= "#0000ff"; //ligne d'eau DROITE
		context.fillRect(490, 0, 10, 500); 

		context.fillStyle= "#0000ff"; //ligne d'eau BAS DROITE
		context.fillRect(350, 490, 140, 10); 

	    if (senshero == "droite") {
	    	context.drawImage(hero_droite, centrex - 20, centrey - 20, 40, 40);
	    }else{
	    	context.drawImage(hero_gauche, centrex - 20, centrey - 20, 40, 40);
	    }

		requestAnimationFrame(boucle);
	} 



</script>
</body>
</html>
